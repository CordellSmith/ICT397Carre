<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Assignment2 - OOber Taxi: C:/Users/New/Documents/Games_Technology/Year4_Semester1/ICT397/~My Work/Assignment2/ICT397Carre/CarreGameEngine/Dependencies/BulletPhysicsEngine/include/BulletInverseDynamics/MultiBodyTree.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>C:/Users/New/Documents/Games_Technology/Year4_Semester1/ICT397/~My Work/Assignment2/ICT397Carre/CarreGameEngine/Dependencies/BulletPhysicsEngine/include/BulletInverseDynamics/MultiBodyTree.cpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include "MultiBodyTree.hpp"</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;limits&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include "IDMath.hpp"</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include "details/MultiBodyTreeImpl.hpp"</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include "details/MultiBodyTreeInitCache.hpp"</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="keyword">namespace </span>btInverseDynamics {
<a name="l00012"></a>00012 
<a name="l00013"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#75c5f172165331d0c64f7fc02301b12a">00013</a> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#75c5f172165331d0c64f7fc02301b12a">MultiBodyTree::MultiBodyTree</a>()
<a name="l00014"></a>00014         : m_is_finalized(false),
<a name="l00015"></a>00015           m_mass_parameters_are_valid(true),
<a name="l00016"></a>00016           m_accept_invalid_mass_parameters(false),
<a name="l00017"></a>00017           m_impl(0x0),
<a name="l00018"></a>00018           m_init_cache(0x0) {
<a name="l00019"></a>00019         m_init_cache = <span class="keyword">new</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_init_cache.html">InitCache</a>();
<a name="l00020"></a>00020 }
<a name="l00021"></a>00021 
<a name="l00022"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#4029fa0c6dc19ee5f4ebfb19fed8821b">00022</a> MultiBodyTree::~MultiBodyTree() {
<a name="l00023"></a>00023         <span class="keyword">delete</span> m_impl;
<a name="l00024"></a>00024         <span class="keyword">delete</span> m_init_cache;
<a name="l00025"></a>00025 }
<a name="l00026"></a>00026 
<a name="l00027"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#5ba35645225ad53584dcd0908d26c8ea">00027</a> <span class="keywordtype">void</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#5ba35645225ad53584dcd0908d26c8ea">MultiBodyTree::setAcceptInvalidMassParameters</a>(<span class="keywordtype">bool</span> flag) {
<a name="l00028"></a>00028         m_accept_invalid_mass_parameters = flag;
<a name="l00029"></a>00029 }
<a name="l00030"></a>00030 
<a name="l00031"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#ea23f21f50889b30dbf41ad57957dcee">00031</a> <span class="keywordtype">bool</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#ea23f21f50889b30dbf41ad57957dcee">MultiBodyTree::getAcceptInvalidMassProperties</a>()<span class="keyword"> const </span>{
<a name="l00032"></a>00032         <span class="keywordflow">return</span> m_accept_invalid_mass_parameters;
<a name="l00033"></a>00033 }
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#14722e25a8c6cc0cb0d1ba848577e174">00035</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#14722e25a8c6cc0cb0d1ba848577e174">MultiBodyTree::getBodyOrigin</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a> *world_origin)<span class="keyword"> const </span>{
<a name="l00036"></a>00036         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#efc23817afea0d39e6a3786a6f5ba504">getBodyOrigin</a>(body_index, world_origin);
<a name="l00037"></a>00037 }
<a name="l00038"></a>00038 
<a name="l00039"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#86d4152e8487c354a725e71e92851002">00039</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#86d4152e8487c354a725e71e92851002">MultiBodyTree::getBodyCoM</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a> *world_com)<span class="keyword"> const </span>{
<a name="l00040"></a>00040         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#7787b44956c65fc638368273382070df">getBodyCoM</a>(body_index, world_com);
<a name="l00041"></a>00041 }
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#582514119940a8dcc10d06cd97019143">00043</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#582514119940a8dcc10d06cd97019143">MultiBodyTree::getBodyTransform</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, mat33 *world_T_body)<span class="keyword"> const </span>{
<a name="l00044"></a>00044         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#2ed9b926162aaf1eacf4f85190b014c7">getBodyTransform</a>(body_index, world_T_body);
<a name="l00045"></a>00045 }
<a name="l00046"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#441236989196e2c5f7219f420ddc6620">00046</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#441236989196e2c5f7219f420ddc6620">MultiBodyTree::getBodyAngularVelocity</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a> *world_omega)<span class="keyword"> const </span>{
<a name="l00047"></a>00047         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#82fbc5d66ecc8e9392f4cf62ec5bf239">getBodyAngularVelocity</a>(body_index, world_omega);
<a name="l00048"></a>00048 }
<a name="l00049"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#c8076ba03722eb2744d1cccd09bfeb41">00049</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#c8076ba03722eb2744d1cccd09bfeb41">MultiBodyTree::getBodyLinearVelocity</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a> *world_velocity)<span class="keyword"> const </span>{
<a name="l00050"></a>00050         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#87604495df09957e2ecd33336bcb8c0f">getBodyLinearVelocity</a>(body_index, world_velocity);
<a name="l00051"></a>00051 }
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#0e3e87b9f2531a8771fa7193449ca26d">00053</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#0e3e87b9f2531a8771fa7193449ca26d">MultiBodyTree::getBodyLinearVelocityCoM</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a> *world_velocity)<span class="keyword"> const </span>{
<a name="l00054"></a>00054         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#0e79f2666001d56b28eb1df102aa970d">getBodyLinearVelocityCoM</a>(body_index, world_velocity);
<a name="l00055"></a>00055 }
<a name="l00056"></a>00056 
<a name="l00057"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#1f216eaec9b229133a1a59ac0b415d13">00057</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#1f216eaec9b229133a1a59ac0b415d13">MultiBodyTree::getBodyAngularAcceleration</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a> *world_dot_omega)<span class="keyword"> const </span>{
<a name="l00058"></a>00058         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#b63dfaa8b761e8258317835648c78358">getBodyAngularAcceleration</a>(body_index, world_dot_omega);
<a name="l00059"></a>00059 }
<a name="l00060"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#07aeba9ee7505e1c2a4c8a5f317bcf22">00060</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#07aeba9ee7505e1c2a4c8a5f317bcf22">MultiBodyTree::getBodyLinearAcceleration</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a> *world_acceleration)<span class="keyword"> const </span>{
<a name="l00061"></a>00061         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#86e8d45849ab884db42e9fc53fd155ca">getBodyLinearAcceleration</a>(body_index, world_acceleration);
<a name="l00062"></a>00062 }
<a name="l00063"></a>00063 
<a name="l00064"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#d7b1596a98a55cd32c3af072a82dcade">00064</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#d7b1596a98a55cd32c3af072a82dcade">MultiBodyTree::getParentRParentBodyRef</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a>* r)<span class="keyword"> const </span>{
<a name="l00065"></a>00065     <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#92f65125b9ebf8c347e4f52df440f69b">getParentRParentBodyRef</a>(body_index, r);
<a name="l00066"></a>00066 }
<a name="l00067"></a>00067 
<a name="l00068"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#3781cd90824117bc9f483b4f13b26f1c">00068</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#3781cd90824117bc9f483b4f13b26f1c">MultiBodyTree::getBodyTParentRef</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, mat33* T)<span class="keyword"> const </span>{
<a name="l00069"></a>00069     <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#e42c54a737ebba57e2d0e30f4cce7af4">getBodyTParentRef</a>(body_index, T);
<a name="l00070"></a>00070 }
<a name="l00071"></a>00071 
<a name="l00072"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#07d19dbfe7c35c0b455b7d58e9f4b014">00072</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#07d19dbfe7c35c0b455b7d58e9f4b014">MultiBodyTree::getBodyAxisOfMotion</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a>* <a class="code" href="group__gtc__quaternion.html#g5c243b588291c790bf1b5ec3f0f08d1b">axis</a>)<span class="keyword"> const </span>{
<a name="l00073"></a>00073     <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#3a0e4f72e0c1f41332e738014fd5f257">getBodyAxisOfMotion</a>(body_index, axis);
<a name="l00074"></a>00074 }
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#1927127806e1211de9324504feae8bc7">00076</a> <span class="keywordtype">void</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#1927127806e1211de9324504feae8bc7" title="pretty print ascii description of tree to stdout">MultiBodyTree::printTree</a>() { m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#52b68afe0f3404617e2de19df70a4c5f" title="pretty print tree">printTree</a>(); }
<a name="l00077"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#f1b892a77455293f6fe3a0d1594f2548">00077</a> <span class="keywordtype">void</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#f1b892a77455293f6fe3a0d1594f2548" title="print tree data to stdout">MultiBodyTree::printTreeData</a>() { m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#d35f3180deb174def89f4b7bc48c4629" title="print tree data">printTreeData</a>(); }
<a name="l00078"></a>00078 
<a name="l00079"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#bfc83ec7cbf274ba67c4fe234bca2041">00079</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#bfc83ec7cbf274ba67c4fe234bca2041" title="returns number of bodies in tree">MultiBodyTree::numBodies</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#b92adb6e430e4b3c6a4e77cc6e96cf4f">m_num_bodies</a>; }
<a name="l00080"></a>00080 
<a name="l00081"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#84caec9630c1db03d88c068bf39be9df">00081</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#84caec9630c1db03d88c068bf39be9df" title="returns number of mechanical degrees of freedom (dimension of q-vector)">MultiBodyTree::numDoFs</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#e5033165247eb8b8d1429eec1470f960">m_num_dofs</a>; }
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#20e281422ee7504a25357275c08d5690">00083</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#20e281422ee7504a25357275c08d5690">MultiBodyTree::calculateInverseDynamics</a>(<span class="keyword">const</span> vecx &amp;q, <span class="keyword">const</span> vecx &amp;u, <span class="keyword">const</span> vecx &amp;dot_u,
<a name="l00084"></a>00084                                                                                         vecx *joint_forces) {
<a name="l00085"></a>00085         <span class="keywordflow">if</span> (<span class="keyword">false</span> == m_is_finalized) {
<a name="l00086"></a>00086                 error_message(<span class="stringliteral">"system has not been initialized\n"</span>);
<a name="l00087"></a>00087                 <span class="keywordflow">return</span> -1;
<a name="l00088"></a>00088         }
<a name="l00089"></a>00089         <span class="keywordflow">if</span> (-1 == m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#408ca0c5fe8fcd75b2b8672e96c2237a">calculateInverseDynamics</a>(q, u, dot_u, joint_forces)) {
<a name="l00090"></a>00090                 error_message(<span class="stringliteral">"error in inverse dynamics calculation\n"</span>);
<a name="l00091"></a>00091                 <span class="keywordflow">return</span> -1;
<a name="l00092"></a>00092         }
<a name="l00093"></a>00093         <span class="keywordflow">return</span> 0;
<a name="l00094"></a>00094 }
<a name="l00095"></a>00095 
<a name="l00096"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#0a767d639bb90ad3b1cb529eb26baa75">00096</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#0a767d639bb90ad3b1cb529eb26baa75">MultiBodyTree::calculateMassMatrix</a>(<span class="keyword">const</span> vecx &amp;q, <span class="keyword">const</span> <span class="keywordtype">bool</span> update_kinematics,
<a name="l00097"></a>00097                                                                            <span class="keyword">const</span> <span class="keywordtype">bool</span> initialize_matrix,
<a name="l00098"></a>00098                                                                            <span class="keyword">const</span> <span class="keywordtype">bool</span> set_lower_triangular_matrix, matxx *mass_matrix) {
<a name="l00099"></a>00099         <span class="keywordflow">if</span> (<span class="keyword">false</span> == m_is_finalized) {
<a name="l00100"></a>00100                 error_message(<span class="stringliteral">"system has not been initialized\n"</span>);
<a name="l00101"></a>00101                 <span class="keywordflow">return</span> -1;
<a name="l00102"></a>00102         }
<a name="l00103"></a>00103         <span class="keywordflow">if</span> (-1 ==
<a name="l00104"></a>00104                 m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#6e4b376b92377b3350d4ebfd94652a0f">calculateMassMatrix</a>(q, update_kinematics, initialize_matrix,
<a name="l00105"></a>00105                                                                         set_lower_triangular_matrix, mass_matrix)) {
<a name="l00106"></a>00106                 error_message(<span class="stringliteral">"error in mass matrix calculation\n"</span>);
<a name="l00107"></a>00107                 <span class="keywordflow">return</span> -1;
<a name="l00108"></a>00108         }
<a name="l00109"></a>00109         <span class="keywordflow">return</span> 0;
<a name="l00110"></a>00110 }
<a name="l00111"></a>00111 
<a name="l00112"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#07b710ad4cbbe4cdadd8e2b5ad7c854a">00112</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#0a767d639bb90ad3b1cb529eb26baa75">MultiBodyTree::calculateMassMatrix</a>(<span class="keyword">const</span> vecx &amp;q, matxx *mass_matrix) {
<a name="l00113"></a>00113         <span class="keywordflow">return</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#0a767d639bb90ad3b1cb529eb26baa75">calculateMassMatrix</a>(q, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, mass_matrix);
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 
<a name="l00118"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#fa6df6ee25f28a4de404d82c6bbf78ff">00118</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#fa6df6ee25f28a4de404d82c6bbf78ff">MultiBodyTree::calculateKinematics</a>(<span class="keyword">const</span> vecx&amp; q, <span class="keyword">const</span> vecx&amp; u, <span class="keyword">const</span> vecx&amp; dot_u) {
<a name="l00119"></a>00119     <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a> world_gravity(m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#27e9624bdea2f330189f7b55786a6dbd">m_world_gravity</a>);
<a name="l00120"></a>00120     <span class="comment">// temporarily set gravity to zero, to ensure we get the actual accelerations</span>
<a name="l00121"></a>00121     setZero(m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#27e9624bdea2f330189f7b55786a6dbd">m_world_gravity</a>);
<a name="l00122"></a>00122 
<a name="l00123"></a>00123     <span class="keywordflow">if</span> (<span class="keyword">false</span> == m_is_finalized) {
<a name="l00124"></a>00124         error_message(<span class="stringliteral">"system has not been initialized\n"</span>);
<a name="l00125"></a>00125         <span class="keywordflow">return</span> -1;
<a name="l00126"></a>00126     }
<a name="l00127"></a>00127     <span class="keywordflow">if</span> (-1 == m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#32cb26dc4a94027f8206182f5a528bea">calculateKinematics</a>(q, u, dot_u,
<a name="l00128"></a>00128                                           MultiBodyTree::MultiBodyImpl::POSITION_VELOCITY_ACCELERATION)) {
<a name="l00129"></a>00129         error_message(<span class="stringliteral">"error in kinematics calculation\n"</span>);
<a name="l00130"></a>00130         <span class="keywordflow">return</span> -1;
<a name="l00131"></a>00131     }
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#27e9624bdea2f330189f7b55786a6dbd">m_world_gravity</a>=world_gravity;
<a name="l00134"></a>00134     <span class="keywordflow">return</span> 0;
<a name="l00135"></a>00135 }
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 
<a name="l00138"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#4bc4655645713c44425ce3bcb01d63ca">00138</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#4bc4655645713c44425ce3bcb01d63ca" title="Calculate position kinematics.">MultiBodyTree::calculatePositionKinematics</a>(<span class="keyword">const</span> vecx&amp; q) {
<a name="l00139"></a>00139         <span class="keywordflow">if</span> (<span class="keyword">false</span> == m_is_finalized) {
<a name="l00140"></a>00140                 error_message(<span class="stringliteral">"system has not been initialized\n"</span>);
<a name="l00141"></a>00141                 <span class="keywordflow">return</span> -1;
<a name="l00142"></a>00142         }
<a name="l00143"></a>00143         <span class="keywordflow">if</span> (-1 == m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#32cb26dc4a94027f8206182f5a528bea">calculateKinematics</a>(q, q, q,
<a name="l00144"></a>00144                                               MultiBodyTree::MultiBodyImpl::POSITION_VELOCITY)) {
<a name="l00145"></a>00145                 error_message(<span class="stringliteral">"error in kinematics calculation\n"</span>);
<a name="l00146"></a>00146                 <span class="keywordflow">return</span> -1;
<a name="l00147"></a>00147         }
<a name="l00148"></a>00148         <span class="keywordflow">return</span> 0;
<a name="l00149"></a>00149 }
<a name="l00150"></a>00150 
<a name="l00151"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#843255f7b29f4c65dc1201d122373a13">00151</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#843255f7b29f4c65dc1201d122373a13" title="Calculate position and velocity kinematics.">MultiBodyTree::calculatePositionAndVelocityKinematics</a>(<span class="keyword">const</span> vecx&amp; q, <span class="keyword">const</span> vecx&amp; u) {
<a name="l00152"></a>00152         <span class="keywordflow">if</span> (<span class="keyword">false</span> == m_is_finalized) {
<a name="l00153"></a>00153                 error_message(<span class="stringliteral">"system has not been initialized\n"</span>);
<a name="l00154"></a>00154                 <span class="keywordflow">return</span> -1;
<a name="l00155"></a>00155         }
<a name="l00156"></a>00156         <span class="keywordflow">if</span> (-1 == m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#32cb26dc4a94027f8206182f5a528bea">calculateKinematics</a>(q, u, u,
<a name="l00157"></a>00157                                               MultiBodyTree::MultiBodyImpl::POSITION_VELOCITY)) {
<a name="l00158"></a>00158                 error_message(<span class="stringliteral">"error in kinematics calculation\n"</span>);
<a name="l00159"></a>00159                 <span class="keywordflow">return</span> -1;
<a name="l00160"></a>00160         }
<a name="l00161"></a>00161         <span class="keywordflow">return</span> 0;
<a name="l00162"></a>00162 }
<a name="l00163"></a>00163 
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 <span class="preprocessor">#if (defined BT_ID_HAVE_MAT3X) &amp;&amp; (defined BT_ID_WITH_JACOBIANS)</span>
<a name="l00166"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#b28d924ffc2226b224e2046497162227">00166</a> <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#b28d924ffc2226b224e2046497162227">MultiBodyTree::calculateJacobians</a>(<span class="keyword">const</span> vecx&amp; q, <span class="keyword">const</span> vecx&amp; u) {
<a name="l00167"></a>00167     <span class="keywordflow">if</span> (<span class="keyword">false</span> == m_is_finalized) {
<a name="l00168"></a>00168         error_message(<span class="stringliteral">"system has not been initialized\n"</span>);
<a name="l00169"></a>00169         <span class="keywordflow">return</span> -1;
<a name="l00170"></a>00170     }
<a name="l00171"></a>00171     <span class="keywordflow">if</span> (-1 == m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#3864ebdf6fe5e3589945f347e8d188a7" title="calculate jacobians and (if type == POSITION_VELOCITY), also velocity-dependent accelration...">calculateJacobians</a>(q, u,
<a name="l00172"></a>00172                                          MultiBodyTree::MultiBodyImpl::POSITION_VELOCITY)) {
<a name="l00173"></a>00173         error_message(<span class="stringliteral">"error in jacobian calculation\n"</span>);
<a name="l00174"></a>00174         <span class="keywordflow">return</span> -1;
<a name="l00175"></a>00175     }
<a name="l00176"></a>00176     <span class="keywordflow">return</span> 0;
<a name="l00177"></a>00177 }
<a name="l00178"></a>00178 
<a name="l00179"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#d036684dcd9a68f732bc37ba2a4ed894">00179</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#b28d924ffc2226b224e2046497162227">MultiBodyTree::calculateJacobians</a>(<span class="keyword">const</span> vecx&amp; q){
<a name="l00180"></a>00180     <span class="keywordflow">if</span> (<span class="keyword">false</span> == m_is_finalized) {
<a name="l00181"></a>00181         error_message(<span class="stringliteral">"system has not been initialized\n"</span>);
<a name="l00182"></a>00182         <span class="keywordflow">return</span> -1;
<a name="l00183"></a>00183     }
<a name="l00184"></a>00184     <span class="keywordflow">if</span> (-1 == m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#3864ebdf6fe5e3589945f347e8d188a7" title="calculate jacobians and (if type == POSITION_VELOCITY), also velocity-dependent accelration...">calculateJacobians</a>(q, q,
<a name="l00185"></a>00185                                          MultiBodyTree::MultiBodyImpl::POSITION_ONLY)) {
<a name="l00186"></a>00186         error_message(<span class="stringliteral">"error in jacobian calculation\n"</span>);
<a name="l00187"></a>00187         <span class="keywordflow">return</span> -1;
<a name="l00188"></a>00188     }
<a name="l00189"></a>00189     <span class="keywordflow">return</span> 0;
<a name="l00190"></a>00190 }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 <span class="keywordtype">int</span> MultiBodyTree::getBodyDotJacobianTransU(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a>* world_dot_jac_trans_u)<span class="keyword"> const </span>{
<a name="l00193"></a>00193     <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#3121da37900effff77e309b2c5a2cd16">getBodyDotJacobianTransU</a>(body_index,world_dot_jac_trans_u);
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 
<a name="l00196"></a>00196 <span class="keywordtype">int</span> MultiBodyTree::getBodyDotJacobianRotU(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <a class="code" href="group__core__types.html#g1c47e8b3386109bc992b6c48e91b0be7">vec3</a>* world_dot_jac_rot_u)<span class="keyword"> const </span>{
<a name="l00197"></a>00197     <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#dd377929159d3005cb80eb694ebed57e">getBodyDotJacobianRotU</a>(body_index,world_dot_jac_rot_u);
<a name="l00198"></a>00198 }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <span class="keywordtype">int</span> MultiBodyTree::getBodyJacobianTrans(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, mat3x* world_jac_trans)<span class="keyword"> const </span>{
<a name="l00201"></a>00201     <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#de8deee754a4e09bd652920a4e63875c">getBodyJacobianTrans</a>(body_index,world_jac_trans);
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 
<a name="l00204"></a>00204 <span class="keywordtype">int</span> MultiBodyTree::getBodyJacobianRot(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, mat3x* world_jac_rot)<span class="keyword"> const  </span>{
<a name="l00205"></a>00205     <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#6ad506d2cc78d6184decd005bdabdce7">getBodyJacobianRot</a>(body_index,world_jac_rot);
<a name="l00206"></a>00206 }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 
<a name="l00209"></a>00209 <span class="preprocessor">#endif</span>
<a name="l00210"></a>00210 <span class="preprocessor"></span>
<a name="l00211"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#d1f6d18e60ec7be3ec03b5aa9b8875b6">00211</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#d1f6d18e60ec7be3ec03b5aa9b8875b6">MultiBodyTree::addBody</a>(<span class="keywordtype">int</span> body_index, <span class="keywordtype">int</span> parent_index, JointType joint_type,
<a name="l00212"></a>00212                                                    <span class="keyword">const</span> <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a> &amp;parent_r_parent_body_ref, <span class="keyword">const</span> mat33 &amp;body_T_parent_ref,
<a name="l00213"></a>00213                                                    <span class="keyword">const</span> <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a> &amp;body_axis_of_motion_, idScalar mass,
<a name="l00214"></a>00214                                                    <span class="keyword">const</span> <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a> &amp;body_r_body_com, <span class="keyword">const</span> mat33 &amp;body_I_body,
<a name="l00215"></a>00215                                                    <span class="keyword">const</span> <span class="keywordtype">int</span> user_int, <span class="keywordtype">void</span> *user_ptr) {
<a name="l00216"></a>00216         <span class="keywordflow">if</span> (body_index &lt; 0) {
<a name="l00217"></a>00217                 error_message(<span class="stringliteral">"body index must be positive (got %d)\n"</span>, body_index);
<a name="l00218"></a>00218                 <span class="keywordflow">return</span> -1;
<a name="l00219"></a>00219         }
<a name="l00220"></a>00220         <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a> body_axis_of_motion(body_axis_of_motion_);
<a name="l00221"></a>00221         <span class="keywordflow">switch</span> (joint_type) {
<a name="l00222"></a>00222                 <span class="keywordflow">case</span> REVOLUTE:
<a name="l00223"></a>00223                 <span class="keywordflow">case</span> PRISMATIC:
<a name="l00224"></a>00224                         <span class="comment">// check if axis is unit vector</span>
<a name="l00225"></a>00225                         <span class="keywordflow">if</span> (!isUnitVector(body_axis_of_motion)) {
<a name="l00226"></a>00226                                 warning_message(
<a name="l00227"></a>00227                                         <span class="stringliteral">"axis of motion not a unit axis ([%f %f %f]), will use normalized vector\n"</span>,
<a name="l00228"></a>00228                                         body_axis_of_motion(0), body_axis_of_motion(1), body_axis_of_motion(2));
<a name="l00229"></a>00229                                 idScalar <a class="code" href="group__gtc__quaternion.html#g286560b01bedb4e046ffb71de22464f4">length</a> = BT_ID_SQRT(BT_ID_POW(body_axis_of_motion(0), 2) +
<a name="l00230"></a>00230                                                                            BT_ID_POW(body_axis_of_motion(1), 2) +
<a name="l00231"></a>00231                                                                            BT_ID_POW(body_axis_of_motion(2), 2));
<a name="l00232"></a>00232                                 <span class="keywordflow">if</span> (length &lt; BT_ID_SQRT(<a class="code" href="group__gtx__extented__min__max.html#gca95a5fd4be0ad53f4474e69867bf974">std::numeric_limits&lt;idScalar&gt;::min</a>())) {
<a name="l00233"></a>00233                                         error_message(<span class="stringliteral">"axis of motion vector too short (%e)\n"</span>, length);
<a name="l00234"></a>00234                                         <span class="keywordflow">return</span> -1;
<a name="l00235"></a>00235                                 }
<a name="l00236"></a>00236                                 body_axis_of_motion = (1.0 / length) * body_axis_of_motion;
<a name="l00237"></a>00237                         }
<a name="l00238"></a>00238                         <span class="keywordflow">break</span>;
<a name="l00239"></a>00239                 <span class="keywordflow">case</span> FIXED:
<a name="l00240"></a>00240                         <span class="keywordflow">break</span>;
<a name="l00241"></a>00241                 <span class="keywordflow">case</span> FLOATING:
<a name="l00242"></a>00242                         <span class="keywordflow">break</span>;
<a name="l00243"></a>00243                 <span class="keywordflow">default</span>:
<a name="l00244"></a>00244                         error_message(<span class="stringliteral">"unknown joint type %d\n"</span>, joint_type);
<a name="l00245"></a>00245                         <span class="keywordflow">return</span> -1;
<a name="l00246"></a>00246         }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248         <span class="comment">// sanity check for mass properties. Zero mass is OK.</span>
<a name="l00249"></a>00249         <span class="keywordflow">if</span> (mass &lt; 0) {
<a name="l00250"></a>00250                 m_mass_parameters_are_valid = <span class="keyword">false</span>;
<a name="l00251"></a>00251                 error_message(<span class="stringliteral">"Body %d has invalid mass %e\n"</span>, body_index, mass);
<a name="l00252"></a>00252                 <span class="keywordflow">if</span> (!m_accept_invalid_mass_parameters) {
<a name="l00253"></a>00253                         <span class="keywordflow">return</span> -1;
<a name="l00254"></a>00254                 }
<a name="l00255"></a>00255         }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257         <span class="keywordflow">if</span> (!isValidInertiaMatrix(body_I_body, body_index, FIXED == joint_type)) {
<a name="l00258"></a>00258                 m_mass_parameters_are_valid = <span class="keyword">false</span>;
<a name="l00259"></a>00259                 <span class="comment">// error message printed in function call</span>
<a name="l00260"></a>00260                 <span class="keywordflow">if</span> (!m_accept_invalid_mass_parameters) {
<a name="l00261"></a>00261                         <span class="keywordflow">return</span> -1;
<a name="l00262"></a>00262                 }
<a name="l00263"></a>00263         }
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         <span class="keywordflow">if</span> (!isValidTransformMatrix(body_T_parent_ref)) {
<a name="l00266"></a>00266                 <span class="keywordflow">return</span> -1;
<a name="l00267"></a>00267         }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269         <span class="keywordflow">return</span> m_init_cache-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_init_cache.html#3140b788b6cdc6c5a74cf2da2e8f5fac">addBody</a>(body_index, parent_index, joint_type, parent_r_parent_body_ref,
<a name="l00270"></a>00270                                                                  body_T_parent_ref, body_axis_of_motion, mass, body_r_body_com,
<a name="l00271"></a>00271                                                                  body_I_body, user_int, user_ptr);
<a name="l00272"></a>00272 }
<a name="l00273"></a>00273 
<a name="l00274"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#fc4f7fc8066ceaa8f666fbad2fcbd33d">00274</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#fc4f7fc8066ceaa8f666fbad2fcbd33d">MultiBodyTree::getParentIndex</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <span class="keywordtype">int</span> *parent_index)<span class="keyword"> const </span>{
<a name="l00275"></a>00275         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#ce5ed2225ecc96810f7b385ada048dd6">getParentIndex</a>(body_index, parent_index);
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00278"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#65a04485f338b3c3c1ace010d460a453">00278</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#65a04485f338b3c3c1ace010d460a453">MultiBodyTree::getUserInt</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <span class="keywordtype">int</span> *user_int)<span class="keyword"> const </span>{
<a name="l00279"></a>00279         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#8deabb1a28e38824027d3515a655cdd3">getUserInt</a>(body_index, user_int);
<a name="l00280"></a>00280 }
<a name="l00281"></a>00281 
<a name="l00282"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#32df6e169921b17d1bce944dc83918e9">00282</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#32df6e169921b17d1bce944dc83918e9">MultiBodyTree::getUserPtr</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <span class="keywordtype">void</span> **user_ptr)<span class="keyword"> const </span>{
<a name="l00283"></a>00283         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#53ffec14bf9450a22e881b75f80d8495">getUserPtr</a>(body_index, user_ptr);
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 
<a name="l00286"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#f93f698a6d22d8f735f162c326649342">00286</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#f93f698a6d22d8f735f162c326649342">MultiBodyTree::setUserInt</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <span class="keyword">const</span> <span class="keywordtype">int</span> user_int) {
<a name="l00287"></a>00287         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#975f98e25ccfc364e3e5b6f49bdce2f2">setUserInt</a>(body_index, user_int);
<a name="l00288"></a>00288 }
<a name="l00289"></a>00289 
<a name="l00290"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#d2c37fb7a6cb73b1af87e0b7884717c0">00290</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#d2c37fb7a6cb73b1af87e0b7884717c0">MultiBodyTree::setUserPtr</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <span class="keywordtype">void</span> *<span class="keyword">const</span> user_ptr) {
<a name="l00291"></a>00291         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#e3d149282a6c90ea6b0bcfe9c25066be">setUserPtr</a>(body_index, user_ptr);
<a name="l00292"></a>00292 }
<a name="l00293"></a>00293 
<a name="l00294"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#c82772ed5bebb1edd6513c03ebd719c2">00294</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#c82772ed5bebb1edd6513c03ebd719c2">MultiBodyTree::finalize</a>() {
<a name="l00295"></a>00295         <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;num_bodies = m_init_cache-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_init_cache.html#6203870a6e9093f6c26280feaee27832">numBodies</a>();
<a name="l00296"></a>00296         <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;num_dofs = m_init_cache-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_init_cache.html#38d366cfeb082b06f72eff27befae30b">numDoFs</a>();
<a name="l00297"></a>00297 
<a name="l00298"></a>00298         <span class="keywordflow">if</span>(num_dofs&lt;=0) {
<a name="l00299"></a>00299             error_message(<span class="stringliteral">"Need num_dofs&gt;=1, but num_dofs= %d\n"</span>, num_dofs);
<a name="l00300"></a>00300             <span class="comment">//return -1;</span>
<a name="l00301"></a>00301         }
<a name="l00302"></a>00302 
<a name="l00303"></a>00303         <span class="comment">// 1 allocate internal MultiBody structure</span>
<a name="l00304"></a>00304         m_impl = <span class="keyword">new</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html" title="The MBS implements a tree structured multibody system.">MultiBodyImpl</a>(num_bodies, num_dofs);
<a name="l00305"></a>00305 
<a name="l00306"></a>00306         <span class="comment">// 2 build new index set assuring index(parent) &lt; index(child)</span>
<a name="l00307"></a>00307         <span class="keywordflow">if</span> (-1 == m_init_cache-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_init_cache.html#41e961d85dcd9e9f9aa9b18ac33289c9">buildIndexSets</a>()) {
<a name="l00308"></a>00308                 <span class="keywordflow">return</span> -1;
<a name="l00309"></a>00309         }
<a name="l00310"></a>00310         m_init_cache-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_init_cache.html#e176197bd93ec8b395b9f9c0b538458c">getParentIndexArray</a>(&amp;m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#f49282dfb6eb33da36c6c0a40808bbd5">m_parent_index</a>);
<a name="l00311"></a>00311 
<a name="l00312"></a>00312         <span class="comment">// 3 setup internal kinematic and dynamic data</span>
<a name="l00313"></a>00313         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> index = 0; index &lt; num_bodies; index++) {
<a name="l00314"></a>00314                 <a class="code" href="structbt_inverse_dynamics_1_1_inertia_data.html" title="Mass properties of a rigid body.">InertiaData</a> inertia;
<a name="l00315"></a>00315                 <a class="code" href="structbt_inverse_dynamics_1_1_joint_data.html" title="Joint properties.">JointData</a> joint;
<a name="l00316"></a>00316                 <span class="keywordflow">if</span> (-1 == m_init_cache-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_init_cache.html#ee00442cb04aaf00db41cac11b046567">getInertiaData</a>(index, &amp;inertia)) {
<a name="l00317"></a>00317                         <span class="keywordflow">return</span> -1;
<a name="l00318"></a>00318                 }
<a name="l00319"></a>00319                 <span class="keywordflow">if</span> (-1 == m_init_cache-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_init_cache.html#b877d886f33dd223c33d6629d7531b2d">getJointData</a>(index, &amp;joint)) {
<a name="l00320"></a>00320                         <span class="keywordflow">return</span> -1;
<a name="l00321"></a>00321                 }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323                 <a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html">RigidBody</a> &amp;rigid_body = m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#98949c9df6318d9e39e11ae85904f0b7">m_body_list</a>[index];
<a name="l00324"></a>00324 
<a name="l00325"></a>00325                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#9c2c26d13a5bfceeb1c936830ef98d75" title="Mass.">m_mass</a> = inertia.<a class="code" href="structbt_inverse_dynamics_1_1_inertia_data.html#7fae541ff8201921ef5cd1180dd151e8" title="mass">m_mass</a>;
<a name="l00326"></a>00326                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#0fec2613f8d67563ae5450af75558832" title="Mass times center of gravity in body-fixed frame.">m_body_mass_com</a> = inertia.<a class="code" href="structbt_inverse_dynamics_1_1_inertia_data.html#7fae541ff8201921ef5cd1180dd151e8" title="mass">m_mass</a> * inertia.<a class="code" href="structbt_inverse_dynamics_1_1_inertia_data.html#f55b6b71b418109e2c91d37fef2381c1">m_body_pos_body_com</a>;
<a name="l00327"></a>00327                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#dc6f5a9cc20ea241416a56839010c461" title="Moment of inertia w.r.t. body-fixed frame.">m_body_I_body</a> = inertia.<a class="code" href="structbt_inverse_dynamics_1_1_inertia_data.html#8812049a71e4002728f5be9d75155fea">m_body_I_body</a>;
<a name="l00328"></a>00328                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#bf03ba35f65fcf499e232812fc6d50ff" title="Type of joint.">m_joint_type</a> = joint.<a class="code" href="structbt_inverse_dynamics_1_1_joint_data.html#a1137097b6a384ab20ff337ec971f952" title="type of joint">m_type</a>;
<a name="l00329"></a>00329                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#1bae64073eb9e0ff3f0d15c01a8bc9a1">m_parent_pos_parent_body_ref</a> = joint.<a class="code" href="structbt_inverse_dynamics_1_1_joint_data.html#56c1cd9b4021ca0c202cd059e0759993">m_parent_pos_parent_child_ref</a>;
<a name="l00330"></a>00330                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#4142975a0941e5706ce24323d51ae83d" title="Orientation of joint frame (body-fixed frame at q=0) relative to the parent frame...">m_body_T_parent_ref</a> = joint.<a class="code" href="structbt_inverse_dynamics_1_1_joint_data.html#6725b907ac280e9fd3d1fa8f0032fda4">m_child_T_parent_ref</a>;
<a name="l00331"></a>00331                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#1bae64073eb9e0ff3f0d15c01a8bc9a1">m_parent_pos_parent_body_ref</a> = joint.<a class="code" href="structbt_inverse_dynamics_1_1_joint_data.html#56c1cd9b4021ca0c202cd059e0759993">m_parent_pos_parent_child_ref</a>;
<a name="l00332"></a>00332                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#bf03ba35f65fcf499e232812fc6d50ff" title="Type of joint.">m_joint_type</a> = joint.<a class="code" href="structbt_inverse_dynamics_1_1_joint_data.html#a1137097b6a384ab20ff337ec971f952" title="type of joint">m_type</a>;
<a name="l00333"></a>00333 
<a name="l00334"></a>00334                 <span class="comment">// Set joint Jacobians. Note that the dimension is always 3x1 here to avoid variable sized</span>
<a name="l00335"></a>00335                 <span class="comment">// matrices.</span>
<a name="l00336"></a>00336                 <span class="keywordflow">switch</span> (rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#bf03ba35f65fcf499e232812fc6d50ff" title="Type of joint.">m_joint_type</a>) {
<a name="l00337"></a>00337                         <span class="keywordflow">case</span> REVOLUTE:
<a name="l00338"></a>00338                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#5ce5299988e53be540fa03c23b8bb63e">m_Jac_JR</a>(0) = joint.<a class="code" href="structbt_inverse_dynamics_1_1_joint_data.html#e237c62f233031b18eec950090a1f576">m_child_axis_of_motion</a>(0);
<a name="l00339"></a>00339                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#5ce5299988e53be540fa03c23b8bb63e">m_Jac_JR</a>(1) = joint.<a class="code" href="structbt_inverse_dynamics_1_1_joint_data.html#e237c62f233031b18eec950090a1f576">m_child_axis_of_motion</a>(1);
<a name="l00340"></a>00340                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#5ce5299988e53be540fa03c23b8bb63e">m_Jac_JR</a>(2) = joint.<a class="code" href="structbt_inverse_dynamics_1_1_joint_data.html#e237c62f233031b18eec950090a1f576">m_child_axis_of_motion</a>(2);
<a name="l00341"></a>00341                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#cedf67bbb73601a34c2909136fae1187">m_Jac_JT</a>(0) = 0.0;
<a name="l00342"></a>00342                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#cedf67bbb73601a34c2909136fae1187">m_Jac_JT</a>(1) = 0.0;
<a name="l00343"></a>00343                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#cedf67bbb73601a34c2909136fae1187">m_Jac_JT</a>(2) = 0.0;
<a name="l00344"></a>00344                                 <span class="keywordflow">break</span>;
<a name="l00345"></a>00345                         <span class="keywordflow">case</span> PRISMATIC:
<a name="l00346"></a>00346                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#5ce5299988e53be540fa03c23b8bb63e">m_Jac_JR</a>(0) = 0.0;
<a name="l00347"></a>00347                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#5ce5299988e53be540fa03c23b8bb63e">m_Jac_JR</a>(1) = 0.0;
<a name="l00348"></a>00348                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#5ce5299988e53be540fa03c23b8bb63e">m_Jac_JR</a>(2) = 0.0;
<a name="l00349"></a>00349                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#cedf67bbb73601a34c2909136fae1187">m_Jac_JT</a>(0) = joint.<a class="code" href="structbt_inverse_dynamics_1_1_joint_data.html#e237c62f233031b18eec950090a1f576">m_child_axis_of_motion</a>(0);
<a name="l00350"></a>00350                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#cedf67bbb73601a34c2909136fae1187">m_Jac_JT</a>(1) = joint.<a class="code" href="structbt_inverse_dynamics_1_1_joint_data.html#e237c62f233031b18eec950090a1f576">m_child_axis_of_motion</a>(1);
<a name="l00351"></a>00351                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#cedf67bbb73601a34c2909136fae1187">m_Jac_JT</a>(2) = joint.<a class="code" href="structbt_inverse_dynamics_1_1_joint_data.html#e237c62f233031b18eec950090a1f576">m_child_axis_of_motion</a>(2);
<a name="l00352"></a>00352                                 <span class="keywordflow">break</span>;
<a name="l00353"></a>00353                         <span class="keywordflow">case</span> FIXED:
<a name="l00354"></a>00354                                 <span class="comment">// NOTE/TODO: dimension really should be zero ..</span>
<a name="l00355"></a>00355                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#5ce5299988e53be540fa03c23b8bb63e">m_Jac_JR</a>(0) = 0.0;
<a name="l00356"></a>00356                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#5ce5299988e53be540fa03c23b8bb63e">m_Jac_JR</a>(1) = 0.0;
<a name="l00357"></a>00357                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#5ce5299988e53be540fa03c23b8bb63e">m_Jac_JR</a>(2) = 0.0;
<a name="l00358"></a>00358                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#cedf67bbb73601a34c2909136fae1187">m_Jac_JT</a>(0) = 0.0;
<a name="l00359"></a>00359                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#cedf67bbb73601a34c2909136fae1187">m_Jac_JT</a>(1) = 0.0;
<a name="l00360"></a>00360                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#cedf67bbb73601a34c2909136fae1187">m_Jac_JT</a>(2) = 0.0;
<a name="l00361"></a>00361                                 <span class="keywordflow">break</span>;
<a name="l00362"></a>00362                         <span class="keywordflow">case</span> FLOATING:
<a name="l00363"></a>00363                                 <span class="comment">// NOTE/TODO: this is not really correct.</span>
<a name="l00364"></a>00364                                 <span class="comment">// the Jacobians should be 3x3 matrices here !</span>
<a name="l00365"></a>00365                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#5ce5299988e53be540fa03c23b8bb63e">m_Jac_JR</a>(0) = 0.0;
<a name="l00366"></a>00366                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#5ce5299988e53be540fa03c23b8bb63e">m_Jac_JR</a>(1) = 0.0;
<a name="l00367"></a>00367                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#5ce5299988e53be540fa03c23b8bb63e">m_Jac_JR</a>(2) = 0.0;
<a name="l00368"></a>00368                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#cedf67bbb73601a34c2909136fae1187">m_Jac_JT</a>(0) = 0.0;
<a name="l00369"></a>00369                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#cedf67bbb73601a34c2909136fae1187">m_Jac_JT</a>(1) = 0.0;
<a name="l00370"></a>00370                                 rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#cedf67bbb73601a34c2909136fae1187">m_Jac_JT</a>(2) = 0.0;
<a name="l00371"></a>00371                                 <span class="keywordflow">break</span>;
<a name="l00372"></a>00372                         <span class="keywordflow">default</span>:
<a name="l00373"></a>00373                                 error_message(<span class="stringliteral">"unsupported joint type %d\n"</span>, rigid_body.<a class="code" href="structbt_inverse_dynamics_1_1_rigid_body.html#bf03ba35f65fcf499e232812fc6d50ff" title="Type of joint.">m_joint_type</a>);
<a name="l00374"></a>00374                                 <span class="keywordflow">return</span> -1;
<a name="l00375"></a>00375                 }
<a name="l00376"></a>00376         }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378         <span class="comment">// 4 assign degree of freedom indices &amp; build per-joint-type index arrays</span>
<a name="l00379"></a>00379         <span class="keywordflow">if</span> (-1 == m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#8e65f0c1da65e68e3a482862f3b866c7">generateIndexSets</a>()) {
<a name="l00380"></a>00380                 error_message(<span class="stringliteral">"generating index sets\n"</span>);
<a name="l00381"></a>00381                 <span class="keywordflow">return</span> -1;
<a name="l00382"></a>00382         }
<a name="l00383"></a>00383 
<a name="l00384"></a>00384         <span class="comment">// 5 do some pre-computations ..</span>
<a name="l00385"></a>00385         m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#72bf41dcbbf7d8b5d2a17bbaaeaa5029" title="initialize fixed data">calculateStaticData</a>();
<a name="l00386"></a>00386 
<a name="l00387"></a>00387         <span class="comment">// 6. make sure all user forces are set to zero, as this might not happen</span>
<a name="l00388"></a>00388         <span class="comment">//      in the vector ctors.</span>
<a name="l00389"></a>00389         m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#b3b1f5f6819d8c5529b4d029ea775d10">clearAllUserForcesAndMoments</a>();
<a name="l00390"></a>00390 
<a name="l00391"></a>00391         m_is_finalized = <span class="keyword">true</span>;
<a name="l00392"></a>00392         <span class="keywordflow">return</span> 0;
<a name="l00393"></a>00393 }
<a name="l00394"></a>00394 
<a name="l00395"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#103b593ab2c8759489fbf6673f664288">00395</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#103b593ab2c8759489fbf6673f664288">MultiBodyTree::setGravityInWorldFrame</a>(<span class="keyword">const</span> <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a> &amp;gravity) {
<a name="l00396"></a>00396         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#6a9262d27208b099f1753bfb34178686">setGravityInWorldFrame</a>(gravity);
<a name="l00397"></a>00397 }
<a name="l00398"></a>00398 
<a name="l00399"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#364bd17e226b15ab6615de4bf8de110d">00399</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#364bd17e226b15ab6615de4bf8de110d">MultiBodyTree::getJointType</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, JointType *joint_type)<span class="keyword"> const </span>{
<a name="l00400"></a>00400         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#74c65f858a7a5c93466f6d02a23b4663">getJointType</a>(body_index, joint_type);
<a name="l00401"></a>00401 }
<a name="l00402"></a>00402 
<a name="l00403"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#6591655d73601c531baed6121f89add5">00403</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#6591655d73601c531baed6121f89add5">MultiBodyTree::getJointTypeStr</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <span class="keyword">const</span> <span class="keywordtype">char</span> **joint_type)<span class="keyword"> const </span>{
<a name="l00404"></a>00404         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#42b50ff5d4a4dad7687d8716e737cf04">getJointTypeStr</a>(body_index, joint_type);
<a name="l00405"></a>00405 }
<a name="l00406"></a>00406 
<a name="l00407"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#fd9a288177719c951a7b851a6491f308">00407</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#fd9a288177719c951a7b851a6491f308">MultiBodyTree::getDoFOffset</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <span class="keywordtype">int</span> *q_offset)<span class="keyword"> const </span>{
<a name="l00408"></a>00408         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#4c00fcbd892f06e452ae3c8a8ffa6f19">getDoFOffset</a>(body_index, q_offset);
<a name="l00409"></a>00409 }
<a name="l00410"></a>00410 
<a name="l00411"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#aec1f7c8093f74529f49e7b36bc59ed7">00411</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#aec1f7c8093f74529f49e7b36bc59ed7">MultiBodyTree::setBodyMass</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, idScalar mass) {
<a name="l00412"></a>00412         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#39c5abc3579669646d6c669a7e86032e">setBodyMass</a>(body_index, mass);
<a name="l00413"></a>00413 }
<a name="l00414"></a>00414 
<a name="l00415"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#5d8c853cf45160f049977e16175fa288">00415</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#5d8c853cf45160f049977e16175fa288">MultiBodyTree::setBodyFirstMassMoment</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <span class="keyword">const</span> <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a>&amp; first_mass_moment) {
<a name="l00416"></a>00416         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#bf4ba386bf4546e4bf05588d46cd82b5">setBodyFirstMassMoment</a>(body_index, first_mass_moment);
<a name="l00417"></a>00417 }
<a name="l00418"></a>00418 
<a name="l00419"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#f3c9c78481d8ee170e00946c8499c433">00419</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#f3c9c78481d8ee170e00946c8499c433">MultiBodyTree::setBodySecondMassMoment</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <span class="keyword">const</span> mat33&amp; second_mass_moment) {
<a name="l00420"></a>00420         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#dc1e2a8408ad2e37469f47280d19536f">setBodySecondMassMoment</a>(body_index, second_mass_moment);
<a name="l00421"></a>00421 }
<a name="l00422"></a>00422 
<a name="l00423"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#ca41d87e7d3717d7d621eb20ce968b23">00423</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#ca41d87e7d3717d7d621eb20ce968b23">MultiBodyTree::getBodyMass</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, idScalar *mass)<span class="keyword"> const </span>{
<a name="l00424"></a>00424         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#979fa0066a08422f5b8c1c32e02de8a7">getBodyMass</a>(body_index, mass);
<a name="l00425"></a>00425 }
<a name="l00426"></a>00426 
<a name="l00427"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#65cf073d371fb6c028649964d21fedce">00427</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#65cf073d371fb6c028649964d21fedce">MultiBodyTree::getBodyFirstMassMoment</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a> *first_mass_moment)<span class="keyword"> const </span>{
<a name="l00428"></a>00428         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#67093942de357aa1b3013ed4c342c1de">getBodyFirstMassMoment</a>(body_index, first_mass_moment);
<a name="l00429"></a>00429 }
<a name="l00430"></a>00430 
<a name="l00431"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#be2ffbd34157198fed40e005f7b154ee">00431</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#be2ffbd34157198fed40e005f7b154ee">MultiBodyTree::getBodySecondMassMoment</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, mat33 *second_mass_moment)<span class="keyword"> const </span>{
<a name="l00432"></a>00432         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#8e530e85b355eb2bee0bdd3256529e28">getBodySecondMassMoment</a>(body_index, second_mass_moment);
<a name="l00433"></a>00433 }
<a name="l00434"></a>00434 
<a name="l00435"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#66402f51ab131c39a4d309196ff7c743">00435</a> <span class="keywordtype">void</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#66402f51ab131c39a4d309196ff7c743" title="set all user forces and moments to zero">MultiBodyTree::clearAllUserForcesAndMoments</a>() { m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#b3b1f5f6819d8c5529b4d029ea775d10">clearAllUserForcesAndMoments</a>(); }
<a name="l00436"></a>00436 
<a name="l00437"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#629ed5024a2d1cb7500ebe935231f5e8">00437</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#629ed5024a2d1cb7500ebe935231f5e8">MultiBodyTree::addUserForce</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <span class="keyword">const</span> <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a> &amp;body_force) {
<a name="l00438"></a>00438         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#4f1786c829da5d57e4758437a38b469c">addUserForce</a>(body_index, body_force);
<a name="l00439"></a>00439 }
<a name="l00440"></a>00440 
<a name="l00441"></a><a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#63096d466e1def1657da8eb3a99850fa">00441</a> <span class="keywordtype">int</span> <a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree.html#63096d466e1def1657da8eb3a99850fa">MultiBodyTree::addUserMoment</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> body_index, <span class="keyword">const</span> <a class="code" href="classbt_inverse_dynamics_1_1vec3.html">vec3</a> &amp;body_moment) {
<a name="l00442"></a>00442         <span class="keywordflow">return</span> m_impl-&gt;<a class="code" href="classbt_inverse_dynamics_1_1_multi_body_tree_1_1_multi_body_impl.html#ef25e8becc20bc0ceb7dcdfd853098e0">addUserMoment</a>(body_index, body_moment);
<a name="l00443"></a>00443 }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Jun 1 12:56:48 2018 for Assignment2 - OOber Taxi by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
